<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
<head>
  <title>Mes Pathologies</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/styles.css}">
  <meta th:name="_csrf" th:content="${_csrf.token}"/>
  <meta th:name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="container">
  <h1>Mes Pathologies</h1>

  <!-- Affichage de la liste des pathologies de l'utilisateur -->
  <ul class="list-group mt-3">
    <li class="list-group-item d-flex justify-content-between align-items-center"
        th:each="pathologie : ${pathologies}">
      <span th:text="${pathologie.nom}"></span>
      <button class="btn btn-danger btn-sm"
              th:data-id="${pathologie.idPathologie}"
              th:data-name="${pathologie.nom}"
              onclick="openRemoveModal(this.dataset.id, this.dataset.name)">
        Supprimer
      </button>
    </li>
  </ul>

  <!-- Bouton pour ouvrir le modal d'ajout -->
  <div class="mt-4">
    <button class="btn btn-primary" onclick="openAddModal()">Ajouter une pathologie</button>
    <a th:href="@{/dashboard}" class="btn btn-link">Retour au dashboard</a>
  </div>

  <!-- Modal pour ajouter une pathologie -->
  <div class="modal fade" id="addPathologieModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="addPathologieForm" th:action="@{/pathologies/ajouter}" method="post">
          <div class="modal-header">
            <h5 class="modal-title">Ajouter une pathologie</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="pathologieSelect" class="form-label">SÃ©lectionnez une pathologie</label>
              <select class="form-select" id="pathologieSelect" name="pathologieId" required>
                <option value="">-- Choisir --</option>
                <th:block th:each="path : ${toutesPathologies}">
                  <option th:value="${path.idPathologie}" th:text="${path.nom}"></option>
                </th:block>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
            <button type="submit" class="btn btn-primary">Ajouter</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal pour confirmer la suppression d'une pathologie -->
  <div class="modal fade" id="removePathologieModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="removePathologieForm" th:action="@{/pathologies/supprimer}" method="post">
          <div class="modal-header">
            <h5 class="modal-title">Supprimer la pathologie</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <p>Voulez-vous vraiment supprimer la pathologie <strong id="pathologieName"></strong> ?</p>
            <input type="hidden" id="removePathologieId" name="pathologieId" value="">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
            <button type="submit" class="btn btn-danger">Supprimer</button>
          </div>
        </form>
      </div>
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function openAddModal() {
    var addModal = new bootstrap.Modal(document.getElementById('addPathologieModal'));
    addModal.show();
  }

  function openRemoveModal(id, name) {
    document.getElementById('removePathologieId').value = id;
    document.getElementById('pathologieName').textContent = name;
    var removeModal = new bootstrap.Modal(document.getElementById('removePathologieModal'));
    removeModal.show();
  }
</script>
</body>
</html>
